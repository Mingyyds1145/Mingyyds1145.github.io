<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music</title>
	<link rel="icon" href="https://cdn.jsdelivr.net/gh/Mingyyds1145/mingwebsong@main/icon/favicon.png" type="image/png">
    <style>
        :root {
            /* æµ…è‰²ä¸»é¢˜å˜é‡ */
            --bg-primary: #f0f2f5;
            --bg-secondary: #ffffff;
            --bg-card: rgba(255, 255, 255, 0);
            --bg-card-sidebar: rgba(255, 255, 255, 0.7);
            --bg-card-controls: rgba(255, 255, 255, 0.8);
            --text-primary: #333333;
            --text-secondary: #666666;
            --text-muted: #999999;
            --accent-color: #ff2e63;
            --border-color: rgba(0, 0, 0, 0.1);
            --shadow-color: rgba(0, 0, 0, 0.1);
            --lyrics-bg: rgba(255, 255, 255, 0.8);
            --progress-bg: rgba(0, 0, 0, 0.1);
            --volume-bg: rgba(0, 0, 0, 0.1);
            --hover-bg: rgba(0, 0, 0, 0.05); /* æµ…è‰²æ¨¡å¼hoverèƒŒæ™¯ */
        }

        .dark-theme {
            /* æ·±è‰²ä¸»é¢˜å˜é‡ */
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-card: rgba(30, 30, 46, 0.7);
            --bg-card-sidebar: rgba(20, 20, 35, 0.6);
            --bg-card-controls: rgba(20, 20, 35, 0.8);
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --text-muted: #aaaaaa;
            --accent-color: #ff2e63;
            --border-color: rgba(255, 255, 255, 0.1);
            --shadow-color: rgba(0, 0, 0, 0.4);
            --lyrics-bg: rgba(20, 20, 35, 0.5);
            --progress-bg: rgba(255, 255, 255, 0.2);
            --volume-bg: rgba(255, 255, 255, 0.2);
            --hover-bg: rgba(255, 255, 255, 0.1); /* æ·±è‰²æ¨¡å¼hoverèƒŒæ™¯ */
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            transition: background 0.5s ease, color 0.5s ease;
        }
        
        .music-player {
            width: 100%;
            max-width: 1200px;
            background: var(--bg-card);
            border-radius: 20px;
            box-shadow: 0 15px 30px var(--shadow-color);
            overflow: hidden;
            display: grid;
            grid-template-columns: 1fr 300px;
            grid-template-rows: auto 1fr auto;
            grid-template-areas: 
                "header header"
                "main sidebar"
                "controls controls";
            height: 85vh;
            max-height: 800px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: all 0.5s ease;
        }
        
        /* å¤´éƒ¨åŒºåŸŸ */
        .player-header {
            grid-area: header;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }
        
        .song-info {
            display: flex;
            align-items: center;
        }
        
        .song-info img {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            margin-right: 15px;
        }
        
        .song-details h2 {
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .song-details p {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .player-actions {
            display: flex;
            align-items: center;
        }
        
        .search-container {
            position: relative;
            margin-right: 20px;
        }
        
        .search-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 8px 15px;
            color: var(--text-primary);
            width: 200px;
            font-size: 14px;
            outline: none;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
        }
        
        .search-input:focus {
            background: rgba(255, 255, 255, 0.15);
            width: 250px;
        }
        
        .search-btn {
            background: var(--accent-color);
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .search-btn:hover {
            background: #e01e53;
        }
        
        .player-actions button {
            background: none;
            border: none;
            color: var(--text-primary);
            margin-left: 15px;
            cursor: pointer;
            font-size: 16px;
            opacity: 0.7;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 50%;
        }
        
        .player-actions button:hover {
            opacity: 1;
            background: var(--hover-bg);
        }
        
        .theme-toggle {
            background: none;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 20px;
            margin-left: 15px;
            transition: transform 0.3s;
        }
        
        .theme-toggle:hover {
            transform: rotate(30deg);
            background: var(--hover-bg);
        }
        
        /* ä¸»å†…å®¹åŒºåŸŸ */
        .player-main {
            grid-area: main;
            display: flex;
            padding: 20px;
            gap: 30px;
            min-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        /* ä¾§è¾¹æ æ”¶èµ·æ—¶ï¼Œä¸»å†…å®¹åŒºåŸŸæ‰©å±• */
        .music-player.sidebar-collapsed {
            grid-template-columns: 1fr 0px;
        }
        
        .music-player.sidebar-collapsed .player-main {
            width: 100%;
        }
        
        .album-section {
            flex: 0 0 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .album-cover-container {
            position: relative;
            width: 280px;
            height: 280px;
            margin-bottom: 15px;
        }
        
        .album-cover {
            width: 100%;
            height: 100%;
            border-radius: 10px;
            box-shadow: 0 10px 25px var(--shadow-color);
            transition: border-radius 0.3s;
            object-fit: cover;
        }
        
        .album-cover.circular {
            border-radius: 50%;
        }
        
        .album-cover.rotating {
            animation: rotate 20s linear infinite;
        }
        
        .album-cover.paused {
            animation-play-state: paused;
        }
        
        /* ç§»é™¤åŸæœ‰çš„ä¸“è¾‘æ§åˆ¶æŒ‰é’®åŒºåŸŸ */
        .album-controls {
            display: none;
        }
        
        .album-info {
            text-align: center;
        }
        
        .album-info h2 {
            font-size: 20px;
            margin-bottom: 8px;
        }
        
        .album-info p {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .lyrics-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        /* ä¾§è¾¹æ æ”¶èµ·æ—¶ï¼Œæ­Œè¯æ æ‰©å±• */
        .music-player.sidebar-collapsed .lyrics-section {
            flex: 1;
        }
        
        .lyrics-header {
            margin-bottom: 15px;
        }
        
        .lyrics-header h3 {
            font-size: 18px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }
        
        .lyrics-container {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: var(--lyrics-bg);
            border-radius: 10px;
            position: relative;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            /* ç¡®ä¿æ²¡æœ‰åº•éƒ¨æ»šåŠ¨æ¡ */
            overflow-x: hidden;
        }
        
        .lyric {
            padding: 8px 0;
            text-align: center;
            transition: all 0.3s ease;
            line-height: 1.5;
        }
        
        .lyric-line {
            margin-bottom: 4px;
        }
        
        .lyric-chinese {
            font-size: 16px;
            color: var(--text-secondary);
        }
        
        .lyric-foreign {
            font-size: 12px;
            color: var(--text-muted);
        }
        
        .lyric.active .lyric-chinese {
            color: var(--accent-color);
            font-weight: bold;
            font-size: 18px;
            transform: scale(1.05);
        }
        
        .lyric.active .lyric-foreign {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        /* æ–°å¢ï¼šéšè—æ’­æ”¾è¿‡çš„æ­Œè¯æ ·å¼ */
        .lyric.played {
            opacity: 0.4;
            max-height: 0;
            padding: 0;
            overflow: hidden;
            transition: all 0.5s ease;
        }
        
        /* ä¾§è¾¹æ  */
        .player-sidebar {
            grid-area: sidebar;
            background: var(--bg-card-sidebar);
            padding: 20px;
            overflow-y: auto;
            min-height: 0;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            transform: translateX(0);
        }
        
        /* ä¿®æ”¹ï¼šä¾§è¾¹æ æ”¶èµ·æ—¶ç›´æ¥å‘å³ç§»åŠ¨ */
        .music-player.sidebar-collapsed .player-sidebar {
            transform: translateX(100%);
            width: 0;
            padding: 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .sidebar-header h3 {
            font-size: 16px;
            color: var(--text-secondary);
        }
        
        .sidebar-controls {
            display: flex;
            gap: 5px;
        }
        
        .sidebar-controls button {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 14px;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.3s;
        }
        
        .sidebar-controls button:hover {
            background: var(--hover-bg);
            color: var(--text-primary);
        }
        
        .clear-btn {
            background: none;
            border: none;
            color: var(--accent-color);
            font-size: 12px;
            cursor: pointer;
            opacity: 0.7;
            transition: all 0.3s;
            padding: 5px 10px;
            border-radius: 4px;
        }
        
        .clear-btn:hover {
            opacity: 1;
            background: var(--hover-bg);
        }
        
        .sidebar-tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .sidebar-tab {
            flex: 1;
            text-align: center;
            padding: 8px 0;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-secondary);
            transition: all 0.3s;
            border-bottom: 2px solid transparent;
        }
        
        .sidebar-tab.active {
            color: var(--accent-color);
            border-bottom: 2px solid var(--accent-color);
        }
        
        .sidebar-tab:hover {
            color: var(--text-primary);
        }
        
        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            min-height: 0;
        }
        
        .playlist-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
            margin-bottom: 8px;
            position: relative;
        }
        
        .playlist-item:hover {
            background: var(--hover-bg);
        }
        
        .playlist-item.active {
            background: var(--hover-bg);
        }
        
        .playlist-item img {
            width: 40px;
            height: 40px;
            border-radius: 5px;
            margin-right: 10px;
        }
        
        .playlist-item-info {
            flex: 1;
            overflow: hidden;
        }
        
        .playlist-item-info h4 {
            font-size: 14px;
            margin-bottom: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .playlist-item-info p {
            font-size: 12px;
            color: var(--text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .playlist-item-actions {
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .playlist-item:hover .playlist-item-actions {
            opacity: 1;
        }
        
        .playlist-item-actions button {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 12px;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.3s;
        }
        
        .playlist-item-actions button:hover {
            background: var(--hover-bg);
            color: var(--text-primary);
        }
        
        .playlist-item-actions .next-play-btn {
            color: var(--accent-color);
        }
        
        .loading {
            text-align: center;
            color: var(--text-muted);
            padding: 20px;
        }
        
        /* æ§åˆ¶é¢æ¿ */
        .player-controls {
            grid-area: controls;
            padding: 15px 20px;
            background: var(--bg-card-controls);
            border-top: 1px solid var(--border-color);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .progress-container {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            flex: 1;
            max-width: 500px;
        }
        
        .time {
            font-size: 12px;
            color: var(--text-muted);
            width: 40px;
        }
        
        .progress-bar {
            flex: 1;
            height: 8px;
            background: var(--progress-bg);
            border-radius: 4px;
            margin: 0 10px;
            cursor: pointer;
            position: relative;
        }
        
        .progress {
            height: 100%;
            background: var(--accent-color);
            border-radius: 4px;
            width: 0%;
            position: relative;
        }
        
        .progress-handle {
            position: absolute;
            right: -6px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: #fff;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.2s;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }
        
        .progress-bar:hover .progress-handle,
        .progress-bar.dragging .progress-handle {
            opacity: 1;
        }
        
        .control-buttons {
            display: flex;
            justify-content: center;
            align-items: center;
            flex: 1;
        }
        
        .control-buttons button {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 20px;
            margin: 0 15px;
            cursor: pointer;
            opacity: 0.8;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            position: relative;
        }
        
        .control-buttons button:hover {
            opacity: 1;
            background: var(--hover-bg);
            transform: scale(1.05);
        }
        
        .control-buttons .play-pause {
            font-size: 36px;
            color: var(--accent-color);
            width: 50px;
            height: 50px;
        }
        
        .control-buttons .play-pause:hover {
            transform: scale(1.1);
        }
        
        /* ç»Ÿä¸€å›¾æ ‡æ ·å¼ - å®Œå…¨ä¿®å¤ç‰ˆæœ¬ */
        .control-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            font-size: 24px;
            line-height: 1;
        }
        
        .prev-icon::before {
            content: "â—€";
            font-size:25px;
        }
        
        .next-icon::before {
            content: "â–¶";
            font-size:25px;
        }
        
        .play-icon::before {
            content: "â–¶";
            font-size:37px;
        }
        
        .pause-icon::before {
            content: "â¸";
            font-size:37px;
        }
        
        .volume-container {
            display: flex;
            align-items: center;
            flex: 1;
            justify-content: flex-end;
        }
        
        .volume-icon {
            margin-right: 10px;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .volume-icon:hover {
            background: var(--hover-bg);
            transform: scale(1.05);
        }
        
        .volume-bar-container {
            width: 100px;
            height: 8px;
            background: var(--volume-bg);
            border-radius: 4px;
            position: relative;
            cursor: pointer;
        }
        
        .volume-level {
            height: 100%;
            background: var(--accent-color);
            border-radius: 4px;
            width: 70%;
            position: relative;
        }
        
        .volume-handle {
            position: absolute;
            right: -6px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: #fff;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.2s;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }
        
        .volume-bar-container:hover .volume-handle,
        .volume-bar-container.dragging .volume-handle {
            opacity: 1;
        }
        
        /* è®¾ç½®æŒ‰é’®å’Œèœå• */
        .settings-container {
            position: relative;
            margin-left: 20px;
        }
        
        .settings-btn {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 20px;
            cursor: pointer;
            opacity: 0.8;
            transition: all 0.3s;
            padding: 5px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
        }
        
        .settings-btn:hover {
            opacity: 1;
            background: var(--hover-bg);
            transform: scale(1.05);
        }
        
        .settings-menu {
            position: absolute;
            bottom: 100%;
            right: 0;
            background: var(--bg-card-controls);
            border-radius: 10px;
            padding: 10px;
            min-width: 150px;
            box-shadow: 0 5px 15px var(--shadow-color);
            z-index: 100;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.3s ease;
        }
        
        .settings-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .settings-menu-item {
            background: none;
            border: none;
            color: var(--text-primary);
            padding: 8px 12px;
            width: 100%;
            text-align: left;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            border-radius: 6px;
            transition: background 0.3s;
        }
        
        .settings-menu-item:hover {
            background: var(--hover-bg);
        }
        
        .settings-menu-item.active {
            color: var(--accent-color);
        }
        
        .settings-menu-item.active::before {
            content: "âœ“";
            font-weight: bold;
        }
        
        /* æ–°å¢ï¼šé¢œè‰²è®¾ç½®é¢æ¿ */
        .color-settings-panel {
            position: absolute;
            bottom: 100%;
            right: 0;
            background: var(--bg-card-controls);
            border-radius: 10px;
            padding: 15px;
            width: 280px;
            box-shadow: 0 5px 15px var(--shadow-color);
            z-index: 100;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.3s ease;
        }
        
        .color-settings-panel.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .color-settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .color-settings-title {
            font-size: 16px;
            font-weight: bold;
            color: var(--text-primary);
        }
        
        .color-settings-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 18px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .color-settings-close:hover {
            background: var(--hover-bg);
            color: var(--text-primary);
        }
        
        .color-picker-group {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .color-picker-label {
            flex: 1;
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .color-picker {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: none;
            padding: 0;
        }
        
        .color-picker::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        
        .color-picker::-webkit-color-swatch {
            border: none;
            border-radius: 8px;
        }
        
        .color-reset-btn {
            background: var(--accent-color);
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
            width: 100%;
            margin-top: 10px;
        }
        
        .color-reset-btn:hover {
            background: #e01e53;
        }
        
        /* æ—‹è½¬åŠ¨ç”» */
        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
        
        /* æ»šåŠ¨æ¡æ ·å¼ - åªä¿ç•™å‚ç›´æ»šåŠ¨æ¡ */
        .lyrics-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .lyrics-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }
        
        .lyrics-container::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 3px;
        }
        
        .player-sidebar::-webkit-scrollbar,
        .sidebar-content::-webkit-scrollbar {
            width: 6px;
        }
        
        .player-sidebar::-webkit-scrollbar-track,
        .sidebar-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }
        
        .player-sidebar::-webkit-scrollbar-thumb,
        .sidebar-content::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 3px;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 900px) {
            .music-player {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto auto;
                grid-template-areas: 
                    "header"
                    "main"
                    "sidebar"
                    "controls";
                height: auto;
                min-height: 90vh;
            }
            
            .player-main {
                flex-direction: column;
                gap: 20px;
            }
            
            .album-section {
                flex: 0 0 auto;
            }
            
            .album-cover-container {
                width: 250px;
                height: 250px;
            }
            
            .lyrics-container {
                /* ç§»åŠ¨ç«¯è°ƒæ•´æ­Œè¯å®¹å™¨é«˜åº¦ */
                min-height: 250px;
            }
            
            .player-header {
                flex-direction: column;
                gap: 15px;
            }
            
            .player-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .search-container {
                flex: 1;
                margin-right: 10px;
            }
            
            .search-input {
                width: 100%;
            }
            
            .search-input:focus {
                width: 100%;
            }
            
            .player-controls {
                flex-direction: column;
                gap: 15px;
            }
            
            .progress-container {
                order: 1;
                width: 100%;
                max-width: 100%;
            }
            
            .control-buttons {
                order: 2;
            }
            
            .volume-container {
                order: 3;
                width: 100%;
                justify-content: center;
            }
            
            .settings-container {
                order: 4;
                margin-left: 0;
                margin-top: 10px;
            }
            
            .color-settings-panel {
                width: 260px;
                right: -80px;
            }
            
            /* ç§»åŠ¨ç«¯ä¾§è¾¹æ æ”¶èµ·æ—¶ï¼Œæ­Œè¯æ å…¨å®½ */
            .music-player.sidebar-collapsed .player-main {
                grid-column: 1;
            }
        }
        
        @media (max-height: 700px) {
            .music-player {
                height: 95vh;
            }
            
            .album-cover-container {
                width: 220px;
                height: 220px;
            }
        }
    </style>
</head>
<body>
    <div class="music-player">
        <!-- å¤´éƒ¨åŒºåŸŸ -->
        <div class="player-header">
            <div class="song-info">
                <img src="https://cdn.jsdelivr.net/gh/Mingyyds1145/mingwebsong@main/icon/favicon.png" alt="ä¸“è¾‘å°é¢" id="currentCover">
                <div class="song-details">
                    <h2 id="currentTitle">è¯·æœç´¢éŸ³ä¹</h2>
                    <p id="currentArtist">ç­‰å¾…æ’­æ”¾</p>
                </div>
            </div>
            <div class="player-actions">
                <div class="search-container">
                    <input type="text" class="search-input" placeholder="æœç´¢æ­Œæ›²..." id="searchInput">
                </div>
                <button class="search-btn" id="searchBtn">ğŸ”</button>
                <button id="toggleSidebarBtn" title="æ”¶èµ·/å±•å¼€ä¾§è¾¹æ ">ğŸ“‹</button>
                <button id="downloadBtn" title="ä¸‹è½½å½“å‰æ­Œæ›²"><i>ğŸ“¥</i></button>
                <button><i>â¤</i></button>
                <button class="theme-toggle" id="themeToggle" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>
            </div>
        </div>
        
        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="player-main">
            <div class="album-section">
                <div class="album-cover-container">
                    <img src="https://cdn.jsdelivr.net/gh/Mingyyds1145/mingwebsong@main/icon/favicon.png" alt="ä¸“è¾‘å°é¢" class="album-cover" id="albumCover">
                </div>
                <div class="album-info">
                    <h2 id="albumTitle">è¯·æœç´¢éŸ³ä¹</h2>
                    <p id="albumArtist">ç­‰å¾…æ’­æ”¾</p>
                </div>
            </div>
            
            <div class="lyrics-section">
                <div class="lyrics-header">
                    <h3>æ­Œè¯</h3>
                </div>
                <div class="lyrics-container" id="lyricsContainer">
                    <div class="loading">ç­‰å¾…æ’­æ”¾ï¼Œæ­Œè¯å°†åœ¨æ­¤æ˜¾ç¤º</div>
                </div>
            </div>
        </div>
        
        <!-- ä¾§è¾¹æ  -->
        <div class="player-sidebar" id="playerSidebar">
            <div class="sidebar-tabs">
                <div class="sidebar-tab active" data-tab="search">æœç´¢ç»“æœ</div>
                <div class="sidebar-tab" data-tab="playlist">æ’­æ”¾åˆ—è¡¨</div>
            </div>
            
            <!-- æœç´¢ç»“æœåŒºåŸŸ -->
            <div class="sidebar-content" id="searchResultsContent">
                <div class="sidebar-header">
                    <h3>æœç´¢ç»“æœ</h3>
                    <div class="sidebar-controls">
                        <button class="clear-btn" id="clearResults">æ¸…é™¤</button>
                    </div>
                </div>
                <div class="playlist" id="searchResults">
                    <div class="loading">æœç´¢æ­Œæ›²ä»¥æ˜¾ç¤ºç»“æœ</div>
                </div>
            </div>
            
            <!-- æ’­æ”¾åˆ—è¡¨åŒºåŸŸ -->
            <div class="sidebar-content" id="playlistContent" style="display: none;">
                <div class="sidebar-header">
                    <h3>æ’­æ”¾åˆ—è¡¨</h3>
                    <div class="sidebar-controls">
                        <button class="clear-btn" id="clearPlaylist">æ¸…é™¤</button>
                    </div>
                </div>
                <div class="playlist" id="playlist">
                    <div class="loading">æ’­æ”¾åˆ—è¡¨ä¸ºç©º</div>
                </div>
            </div>
        </div>
        
        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="player-controls">
            <div class="progress-container">
                <span class="time" id="currentTime">0:00</span>
                <div class="progress-bar" id="progressBar">
                    <div class="progress" id="progress">
                        <div class="progress-handle"></div>
                    </div>
                </div>
                <span class="time" id="totalTime">0:00</span>
            </div>
            <div class="control-buttons">
                <button id="prevBtn" title="ä¸Šä¸€é¦–"><span class="control-icon prev-icon"></span></button>
                <button class="play-pause" id="playPauseBtn"><span class="control-icon play-icon"></span></button>
                <button id="nextBtn" title="ä¸‹ä¸€é¦–"><span class="control-icon next-icon"></span></button>
            </div>
            <div class="volume-container">
                <div class="volume-icon" id="volumeIcon">ğŸ”Š</div>
                <div class="volume-bar-container" id="volumeBarContainer">
                    <div class="volume-level" id="volumeLevel">
                        <div class="volume-handle"></div>
                    </div>
                </div>
            </div>
            <div class="settings-container">
                <button class="settings-btn" id="settingsBtn" title="æ’­æ”¾å™¨è®¾ç½®">âš™ï¸</button>
                <div class="settings-menu" id="settingsMenu">
                    <button class="settings-menu-item" id="circularToggle">
                        <span>åœ†å½¢å°é¢</span>
                    </button>
                    <button class="settings-menu-item" id="rotateToggle">
                        <span>æ—‹è½¬å°é¢</span>
                    </button>
                    <!-- æ–°å¢ï¼šéšè—æ’­æ”¾è¿‡çš„æ­Œè¯è®¾ç½® -->
                    <button class="settings-menu-item" id="hideLyricsToggle">
                        <span>éšè—æ’­æ”¾è¿‡çš„æ­Œè¯</span>
                    </button>
                    <!-- æ–°å¢ï¼šé¢œè‰²è‡ªå®šä¹‰è®¾ç½® -->
                    <button class="settings-menu-item" id="colorSettingsToggle">
                        <span>è‡ªå®šä¹‰é¢œè‰²</span>
                    </button>
                </div>
                
                <!-- æ–°å¢ï¼šé¢œè‰²è®¾ç½®é¢æ¿ -->
                <div class="color-settings-panel" id="colorSettingsPanel">
                    <div class="color-settings-header">
                        <div class="color-settings-title">è‡ªå®šä¹‰é¢œè‰²</div>
                        <button class="color-settings-close" id="colorSettingsClose">âœ•</button>
                    </div>
                    
                    <div class="color-picker-group">
                        <div class="color-picker-label">ä¸»èƒŒæ™¯è‰²</div>
                        <input type="color" class="color-picker" id="bgPrimaryColor" value="#f0f2f5" data-var="--bg-primary">
                    </div>
                    
                    <div class="color-picker-group">
                        <div class="color-picker-label">æ¬¡èƒŒæ™¯è‰²</div>
                        <input type="color" class="color-picker" id="bgSecondaryColor" value="#ffffff" data-var="--bg-secondary">
                    </div>
                    
                    <div class="color-picker-group">
                        <div class="color-picker-label">ä¸»æ–‡å­—è‰²</div>
                        <input type="color" class="color-picker" id="textPrimaryColor" value="#333333" data-var="--text-primary">
                    </div>
                    
                    <div class="color-picker-group">
                        <div class="color-picker-label">æ¬¡æ–‡å­—è‰²</div>
                        <input type="color" class="color-picker" id="textSecondaryColor" value="#666666" data-var="--text-secondary">
                    </div>
                    
                    <div class="color-picker-group">
                        <div class="color-picker-label">å¼ºè°ƒè‰²</div>
                        <input type="color" class="color-picker" id="accentColor" value="#ff2e63" data-var="--accent-color">
                    </div>
                    
                    <div class="color-picker-group">
                        <div class="color-picker-label">è¾¹æ¡†è‰²</div>
                        <input type="color" class="color-picker" id="borderColor" value="#1a1a1a" data-var="--border-color">
                    </div>
                    
                    <button class="color-reset-btn" id="colorResetBtn">é‡ç½®é¢œè‰²</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOMå…ƒç´ 
            const player = document.querySelector('.music-player');
            const playPauseBtn = document.getElementById('playPauseBtn');
            const lyricsContainer = document.getElementById('lyricsContainer');
            const progress = document.getElementById('progress');
            const progressBar = document.getElementById('progressBar');
            const currentTimeEl = document.getElementById('currentTime');
            const totalTimeEl = document.getElementById('totalTime');
            const searchInput = document.getElementById('searchInput');
            const searchBtn = document.getElementById('searchBtn');
            const searchResults = document.getElementById('searchResults');
            const clearResultsBtn = document.getElementById('clearResults');
            const currentCover = document.getElementById('currentCover');
            const currentTitle = document.getElementById('currentTitle');
            const currentArtist = document.getElementById('currentArtist');
            const albumCover = document.getElementById('albumCover');
            const albumTitle = document.getElementById('albumTitle');
            const albumArtist = document.getElementById('albumArtist');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            const volumeIcon = document.getElementById('volumeIcon');
            const volumeLevel = document.getElementById('volumeLevel');
            const volumeBarContainer = document.getElementById('volumeBarContainer');
            const themeToggle = document.getElementById('themeToggle');
            const circularToggle = document.getElementById('circularToggle');
            const rotateToggle = document.getElementById('rotateToggle');
            const hideLyricsToggle = document.getElementById('hideLyricsToggle');
            const colorSettingsToggle = document.getElementById('colorSettingsToggle');
            const colorSettingsPanel = document.getElementById('colorSettingsPanel');
            const colorSettingsClose = document.getElementById('colorSettingsClose');
            const colorResetBtn = document.getElementById('colorResetBtn');
            const settingsBtn = document.getElementById('settingsBtn');
            const settingsMenu = document.getElementById('settingsMenu');
            const playIcon = playPauseBtn.querySelector('.control-icon');
            const toggleSidebarBtn = document.getElementById('toggleSidebarBtn');
            const playerSidebar = document.getElementById('playerSidebar');
            const sidebarTabs = document.querySelectorAll('.sidebar-tab');
            const searchResultsContent = document.getElementById('searchResultsContent');
            const playlistContent = document.getElementById('playlistContent');
            const playlist = document.getElementById('playlist');
            const clearPlaylistBtn = document.getElementById('clearPlaylist');
            
            // é¢œè‰²é€‰æ‹©å™¨å…ƒç´ 
            const bgPrimaryColor = document.getElementById('bgPrimaryColor');
            const bgSecondaryColor = document.getElementById('bgSecondaryColor');
            const textPrimaryColor = document.getElementById('textPrimaryColor');
            const textSecondaryColor = document.getElementById('textSecondaryColor');
            const accentColor = document.getElementById('accentColor');
            const borderColor = document.getElementById('borderColor');
            
            // éŸ³é¢‘å¯¹è±¡
            const audio = new Audio();
            let currentSong = null;
            let searchResultSongs = [];
            let currentSongIndex = -1;
            let lyricsData = [];
            let isDraggingProgress = false;
            let isDraggingVolume = false;
            let lyricsLoaded = false;
            let musicLoaded = false;
            let playAfterLoad = false;
            
            // ä¸“è¾‘å°é¢çŠ¶æ€
            let isCircular = false;
            let isRotating = false;
            
            // æ’­æ”¾åˆ—è¡¨
            let playlistSongs = [];
            let playlistCurrentIndex = -1;
            
            // éšè—æ’­æ”¾è¿‡çš„æ­Œè¯çŠ¶æ€
            let hidePlayedLyrics = false;
            
            // è‡ªå®šä¹‰é¢œè‰²çŠ¶æ€
            let hasCustomColors = false;
            
            // è®¾ç½®åˆå§‹éŸ³é‡
            audio.volume = 0.7;
            
            // ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
            function toggleTheme() {
                document.body.classList.toggle('dark-theme');
                // æ›´æ–°ä¸»é¢˜æŒ‰é’®å›¾æ ‡
                themeToggle.textContent = document.body.classList.contains('dark-theme') ? 'â˜€ï¸' : 'ğŸŒ™';
                // ä¿å­˜ä¸»é¢˜åå¥½
                localStorage.setItem('theme', document.body.classList.contains('dark-theme') ? 'dark' : 'light');
                
                // å¦‚æœç”¨æˆ·æ²¡æœ‰è‡ªå®šä¹‰é¢œè‰²ï¼Œåˆ™ä½¿ç”¨ä¸»é¢˜é»˜è®¤é¢œè‰²
                if (!hasCustomColors) {
                    if (document.body.classList.contains('dark-theme')) {
                        resetColorPickersToDark();
                    } else {
                        resetColorPickersToLight();
                    }
                }
            }
            
            // åˆå§‹åŒ–ä¸»é¢˜
            function initTheme() {
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme === 'dark') {
                    document.body.classList.add('dark-theme');
                    themeToggle.textContent = 'â˜€ï¸';
                } else {
                    document.body.classList.remove('dark-theme');
                    themeToggle.textContent = 'ğŸŒ™';
                }
            }
            
            // åˆ‡æ¢åœ†å½¢/æ–¹å½¢
            function toggleCircular() {
                isCircular = !isCircular;
                if (isCircular) {
                    albumCover.classList.add('circular');
                    circularToggle.classList.add('active');
                } else {
                    albumCover.classList.remove('circular');
                    circularToggle.classList.remove('active');
                }
                // ä¿å­˜çŠ¶æ€
                localStorage.setItem('circular', isCircular);
            }
            
            // åˆ‡æ¢æ—‹è½¬çŠ¶æ€
            function toggleRotate() {
                isRotating = !isRotating;
                if (isRotating) {
                    albumCover.classList.add('rotating');
                    rotateToggle.classList.add('active');
                    
                    // å¦‚æœéŸ³ä¹æ­£åœ¨æ’­æ”¾ï¼Œç¡®ä¿æ—‹è½¬åŠ¨ç”»ç»§ç»­
                    if (!audio.paused) {
                        albumCover.classList.remove('paused');
                    }
                } else {
                    albumCover.classList.remove('rotating');
                    rotateToggle.classList.remove('active');
                }
                // ä¿å­˜çŠ¶æ€
                localStorage.setItem('rotating', isRotating);
            }
            
            // åˆ‡æ¢éšè—æ’­æ”¾è¿‡çš„æ­Œè¯
            function toggleHideLyrics() {
                hidePlayedLyrics = !hidePlayedLyrics;
                if (hidePlayedLyrics) {
                    hideLyricsToggle.classList.add('active');
                } else {
                    hideLyricsToggle.classList.remove('active');
                    // å¦‚æœå…³é—­éšè—ï¼Œéœ€è¦æ˜¾ç¤ºæ‰€æœ‰æ­Œè¯
                    document.querySelectorAll('.lyric.played').forEach(el => {
                        el.classList.remove('played');
                    });
                }
                // ä¿å­˜çŠ¶æ€
                localStorage.setItem('hidePlayedLyrics', hidePlayedLyrics);
                
                // é‡æ–°é«˜äº®å½“å‰æ­Œè¯ï¼Œä»¥ç«‹å³åº”ç”¨æ›´æ”¹
                if (currentSong) {
                    highlightCurrentLyric(audio.currentTime);
                }
            }
            
            // åˆå§‹åŒ–ä¸“è¾‘å°é¢çŠ¶æ€
            function initAlbumState() {
                const savedCircular = localStorage.getItem('circular');
                const savedRotating = localStorage.getItem('rotating');
                
                if (savedCircular === 'true') {
                    isCircular = true;
                    albumCover.classList.add('circular');
                    circularToggle.classList.add('active');
                }
                
                if (savedRotating === 'true') {
                    isRotating = true;
                    albumCover.classList.add('rotating');
                    rotateToggle.classList.add('active');
                    
                    // å¦‚æœéŸ³ä¹æ­£åœ¨æ’­æ”¾ï¼Œç¡®ä¿æ—‹è½¬åŠ¨ç”»ç»§ç»­
                    if (!audio.paused) {
                        albumCover.classList.remove('paused');
                    }
                }
            }
            
            // åˆå§‹åŒ–éšè—æ­Œè¯çŠ¶æ€
            function initHideLyricsState() {
                const savedHideLyrics = localStorage.getItem('hidePlayedLyrics');
                if (savedHideLyrics === 'true') {
                    hidePlayedLyrics = true;
                    hideLyricsToggle.classList.add('active');
                } else {
                    hidePlayedLyrics = false;
                    hideLyricsToggle.classList.remove('active');
                }
            }
            
            // è®¾ç½®èœå•æ˜¾ç¤º/éšè—
            function toggleSettingsMenu() {
                settingsMenu.classList.toggle('show');
            }
            
            // é¢œè‰²è®¾ç½®é¢æ¿æ˜¾ç¤º/éšè—
            function toggleColorSettingsPanel() {
                colorSettingsPanel.classList.toggle('show');
                // éšè—ä¸»è®¾ç½®èœå•
                settingsMenu.classList.remove('show');
            }
            
            // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­è®¾ç½®èœå•å’Œé¢œè‰²é¢æ¿
            document.addEventListener('click', function(e) {
                if (!settingsBtn.contains(e.target) && !settingsMenu.contains(e.target)) {
                    settingsMenu.classList.remove('show');
                }
                
                if (!colorSettingsToggle.contains(e.target) && !colorSettingsPanel.contains(e.target)) {
                    colorSettingsPanel.classList.remove('show');
                }
            });
            
            // ä¿®å¤å›¾ç‰‡URLå‡½æ•°
            function fixImageUrl(url) {
                if (!url) return null;
                
                // å¦‚æœURLå·²ç»æ˜¯å®Œæ•´æ ¼å¼ï¼Œç›´æ¥è¿”å›
                if (url.startsWith('http')) return url;
                
                // å¤„ç†APIè¿”å›çš„è½¬ä¹‰å­—ç¬¦
                let fixedUrl = url.replace(/\\\//g, '/');
                
                // å¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œå°è¯•æ„å»ºå®Œæ•´URL
                if (fixedUrl.startsWith('//')) {
                    fixedUrl = 'https:' + fixedUrl;
                }
                
                return fixedUrl;
            }
            
            // åˆ‡æ¢ä¾§è¾¹æ æ˜¾ç¤º/éšè—
            function toggleSidebar() {
                player.classList.toggle('sidebar-collapsed');
                // æ›´æ–°æŒ‰é’®å›¾æ ‡
                toggleSidebarBtn.textContent = player.classList.contains('sidebar-collapsed') ? 'ğŸ“‹' : 'ğŸ“‹';
            }
            
            // åˆ‡æ¢ä¾§è¾¹æ æ ‡ç­¾
            function switchTab(tabName) {
                sidebarTabs.forEach(tab => {
                    tab.classList.toggle('active', tab.dataset.tab === tabName);
                });
                
                if (tabName === 'search') {
                    searchResultsContent.style.display = 'block';
                    playlistContent.style.display = 'none';
                } else {
                    searchResultsContent.style.display = 'none';
                    playlistContent.style.display = 'block';
                }
            }
            
            // é¢œè‰²è‡ªå®šä¹‰åŠŸèƒ½
            function updateColor(variable, value) {
                document.documentElement.style.setProperty(variable, value);
                saveColorSettings();
                hasCustomColors = true;
            }
            
            // ä¿å­˜é¢œè‰²è®¾ç½®
            function saveColorSettings() {
                const colorSettings = {
                    bgPrimary: bgPrimaryColor.value,
                    bgSecondary: bgSecondaryColor.value,
                    textPrimary: textPrimaryColor.value,
                    textSecondary: textSecondaryColor.value,
                    accent: accentColor.value,
                    border: borderColor.value
                };
                localStorage.setItem('colorSettings', JSON.stringify(colorSettings));
            }
            
            // åŠ è½½é¢œè‰²è®¾ç½®
            function loadColorSettings() {
                const savedColors = localStorage.getItem('colorSettings');
                if (savedColors) {
                    const colorSettings = JSON.parse(savedColors);
                    
                    // åº”ç”¨ä¿å­˜çš„é¢œè‰²
                    updateColor('--bg-primary', colorSettings.bgPrimary);
                    updateColor('--bg-secondary', colorSettings.bgSecondary);
                    updateColor('--text-primary', colorSettings.textPrimary);
                    updateColor('--text-secondary', colorSettings.textSecondary);
                    updateColor('--accent-color', colorSettings.accent);
                    updateColor('--border-color', colorSettings.border);
                    
                    // æ›´æ–°é¢œè‰²é€‰æ‹©å™¨çš„å€¼
                    bgPrimaryColor.value = colorSettings.bgPrimary;
                    bgSecondaryColor.value = colorSettings.bgSecondary;
                    textPrimaryColor.value = colorSettings.textPrimary;
                    textSecondaryColor.value = colorSettings.textSecondary;
                    accentColor.value = colorSettings.accent;
                    borderColor.value = colorSettings.border;
                    
                    hasCustomColors = true;
                }
            }
            
            // é‡ç½®é¢œè‰²ä¸ºæµ…è‰²ä¸»é¢˜é»˜è®¤å€¼
            function resetColorPickersToLight() {
                bgPrimaryColor.value = '#f0f2f5';
                bgSecondaryColor.value = '#ffffff';
                textPrimaryColor.value = '#333333';
                textSecondaryColor.value = '#666666';
                accentColor.value = '#ff2e63';
                borderColor.value = 'rgba(0, 0, 0, 0.1)';
                
                // åº”ç”¨é»˜è®¤é¢œè‰²
                updateColor('--bg-primary', '#f0f2f5');
                updateColor('--bg-secondary', '#ffffff');
                updateColor('--text-primary', '#333333');
                updateColor('--text-secondary', '#666666');
                updateColor('--accent-color', '#ff2e63');
                updateColor('--border-color', 'rgba(0, 0, 0, 0.1)');
                
                hasCustomColors = false;
            }
            
            // é‡ç½®é¢œè‰²ä¸ºæ·±è‰²ä¸»é¢˜é»˜è®¤å€¼
            function resetColorPickersToDark() {
                bgPrimaryColor.value = '#1a1a2e';
                bgSecondaryColor.value = '#16213e';
                textPrimaryColor.value = '#ffffff';
                textSecondaryColor.value = '#cccccc';
                accentColor.value = '#ff2e63';
                borderColor.value = 'rgba(255, 255, 255, 0.1)';
                
                // åº”ç”¨é»˜è®¤é¢œè‰²
                updateColor('--bg-primary', '#1a1a2e');
                updateColor('--bg-secondary', '#16213e');
                updateColor('--text-primary', '#ffffff');
                updateColor('--text-secondary', '#cccccc');
                updateColor('--accent-color', '#ff2e63');
                updateColor('--border-color', 'rgba(255, 255, 255, 0.1)');
                
                hasCustomColors = false;
            }
            
            // é‡ç½®é¢œè‰²ä¸ºå½“å‰ä¸»é¢˜é»˜è®¤å€¼
            function resetColors() {
                if (document.body.classList.contains('dark-theme')) {
                    resetColorPickersToDark();
                } else {
                    resetColorPickersToLight();
                }
            }
            
            // æœç´¢æ­Œæ›²
            async function searchSongs(keyword) {
                if (!keyword.trim()) return;
                
                try {
                    searchResults.innerHTML = '<div class="loading">æœç´¢ä¸­...</div>';
                    
                    const response = await fetch(`https://163api.qijieya.cn/search?keywords=${encodeURIComponent(keyword)}`);
                    const data = await response.json();
                    
                    if (data.result && data.result.songs) {
                        searchResultSongs = data.result.songs;
                        displaySearchResults(searchResultSongs);
                    } else {
                        searchResults.innerHTML = '<div class="loading">æœªæ‰¾åˆ°ç›¸å…³æ­Œæ›²</div>';
                    }
                } catch (error) {
                    console.error('æœç´¢å¤±è´¥:', error);
                    searchResults.innerHTML = '<div class="loading">æœç´¢å¤±è´¥ï¼Œè¯·é‡è¯•</div>';
                }
            }
            
            // æ˜¾ç¤ºæœç´¢ç»“æœ
            function displaySearchResults(songs) {
                if (songs.length === 0) {
                    searchResults.innerHTML = '<div class="loading">æœªæ‰¾åˆ°ç›¸å…³æ­Œæ›²</div>';
                    return;
                }
                
                searchResults.innerHTML = '';
                
                songs.forEach((song, index) => {
                    const songItem = document.createElement('div');
                    songItem.className = 'playlist-item';
                    songItem.dataset.id = song.id;
                    songItem.dataset.index = index;
                    
                    // ä¿®å¤å›¾ç‰‡URL
                    const coverUrl = fixImageUrl(song.album.picUrl) || ``;
                    
                    songItem.innerHTML = `
                        <img src="${coverUrl}" alt="${song.name}" onerror="this.src='https://cdn.jsdelivr.net/gh/Mingyyds1145/mingwebsong@main/icon/favicon.png'">
                        <div class="playlist-item-info">
                            <h4>${song.name}</h4>
                            <p>${song.artists.map(artist => artist.name).join(', ')}</p>
                        </div>
                        <div class="playlist-item-actions">
                            <button class="next-play-btn" title="ä¸‹ä¸€é¦–æ’­æ”¾">â­ï¸</button>
                            <button class="add-to-playlist-btn" title="æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨">â•</button>
                        </div>
                    `;
                    
                    songItem.addEventListener('click', (e) => {
                        // é˜²æ­¢ç‚¹å‡»æŒ‰é’®æ—¶è§¦å‘æ’­æ”¾
                        if (!e.target.closest('.playlist-item-actions')) {
                            playSong(song, index, 'search');
                        }
                    });
                    
                    // æ·»åŠ ä¸‹ä¸€é¦–æ’­æ”¾åŠŸèƒ½
                    const nextPlayBtn = songItem.querySelector('.next-play-btn');
                    nextPlayBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        addToNextPlay(song);
                    });
                    
                    // æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨åŠŸèƒ½
                    const addToPlaylistBtn = songItem.querySelector('.add-to-playlist-btn');
                    addToPlaylistBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        addToPlaylist(song);
                    });
                    
                    searchResults.appendChild(songItem);
                });
            }
            
            // æ·»åŠ åˆ°ä¸‹ä¸€é¦–æ’­æ”¾
            function addToNextPlay(song) {
                if (playlistCurrentIndex >= 0) {
                    // åœ¨å½“å‰æ’­æ”¾æ­Œæ›²åæ’å…¥
                    playlistSongs.splice(playlistCurrentIndex + 1, 0, song);
                } else {
                    // å¦‚æœæ²¡æœ‰æ­£åœ¨æ’­æ”¾çš„æ­Œæ›²ï¼Œæ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨å¼€å¤´
                    playlistSongs.unshift(song);
                }
                updatePlaylistDisplay();
                savePlaylist();
                
                // æ˜¾ç¤ºæç¤º
                showNotification(`"${song.name}" å·²æ·»åŠ åˆ°ä¸‹ä¸€é¦–æ’­æ”¾`);
            }
            
            // æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨
            function addToPlaylist(song) {
                // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
                const existingIndex = playlistSongs.findIndex(s => s.id === song.id);
                if (existingIndex === -1) {
                    playlistSongs.push(song);
                    updatePlaylistDisplay();
                    savePlaylist();
                    
                    // æ˜¾ç¤ºæç¤º
                    showNotification(`"${song.name}" å·²æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨`);
                } else {
                    showNotification(`"${song.name}" å·²åœ¨æ’­æ”¾åˆ—è¡¨ä¸­`);
                }
            }
            
            // æ›´æ–°æ’­æ”¾åˆ—è¡¨æ˜¾ç¤º
            function updatePlaylistDisplay() {
                if (playlistSongs.length === 0) {
                    playlist.innerHTML = '<div class="loading">æ’­æ”¾åˆ—è¡¨ä¸ºç©º</div>';
                    return;
                }
                
                playlist.innerHTML = '';
                
                playlistSongs.forEach((song, index) => {
                    const songItem = document.createElement('div');
                    songItem.className = 'playlist-item';
                    if (index === playlistCurrentIndex) {
                        songItem.classList.add('active');
                    }
                    
                    // ä¿®å¤å›¾ç‰‡URL
                    const coverUrl = fixImageUrl(song.album.picUrl) || `https://cdn.jsdelivr.net/gh/Mingyyds1145/mingwebsong@main/icon/favicon.png`;
                    
                    songItem.innerHTML = `
                        <img src="${coverUrl}" alt="${song.name}" onerror="this.src='https://cdn.jsdelivr.net/gh/Mingyyds1145/mingwebsong@main/icon/favicon.png'">
                        <div class="playlist-item-info">
                            <h4>${song.name}</h4>
                            <p>${song.artists.map(artist => artist.name).join(', ')}</p>
                        </div>
                        <div class="playlist-item-actions">
                            <button class="remove-from-playlist-btn" title="ä»æ’­æ”¾åˆ—è¡¨ç§»é™¤">âŒ</button>
                        </div>
                    `;
                    
                    songItem.addEventListener('click', (e) => {
                        // é˜²æ­¢ç‚¹å‡»æŒ‰é’®æ—¶è§¦å‘æ’­æ”¾
                        if (!e.target.closest('.playlist-item-actions')) {
                            playFromPlaylist(index);
                        }
                    });
                    
                    // ç§»é™¤æ­Œæ›²åŠŸèƒ½
                    const removeBtn = songItem.querySelector('.remove-from-playlist-btn');
                    removeBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        removeFromPlaylist(index);
                    });
                    
                    playlist.appendChild(songItem);
                });
            }
            
            // ä»æ’­æ”¾åˆ—è¡¨æ’­æ”¾
            function playFromPlaylist(index) {
                playlistCurrentIndex = index;
                playSong(playlistSongs[index], index, 'playlist');
                updatePlaylistDisplay();
            }
            
            // ä»æ’­æ”¾åˆ—è¡¨ç§»é™¤
            function removeFromPlaylist(index) {
                const songName = playlistSongs[index].name;
                
                // å¦‚æœç§»é™¤çš„æ˜¯å½“å‰æ’­æ”¾çš„æ­Œæ›²
                if (index === playlistCurrentIndex) {
                    if (playlistSongs.length > 1) {
                        // å¦‚æœæœ‰å…¶ä»–æ­Œæ›²ï¼Œæ’­æ”¾ä¸‹ä¸€é¦–
                        if (index < playlistSongs.length - 1) {
                            playFromPlaylist(index);
                        } else {
                            playFromPlaylist(index - 1);
                        }
                    } else {
                        // å¦‚æœåªå‰©ä¸€é¦–æ­Œï¼Œåœæ­¢æ’­æ”¾
                        audio.pause();
                        player.classList.remove('playing');
                        playIcon.className = 'control-icon play-icon';
                        playlistCurrentIndex = -1;
                    }
                }
                
                // è°ƒæ•´å½“å‰æ’­æ”¾ç´¢å¼•
                if (index < playlistCurrentIndex) {
                    playlistCurrentIndex--;
                }
                
                playlistSongs.splice(index, 1);
                updatePlaylistDisplay();
                savePlaylist();
                
                // æ˜¾ç¤ºæç¤º
                showNotification(`"${songName}" å·²ä»æ’­æ”¾åˆ—è¡¨ç§»é™¤`);
            }
            
            // ä¿å­˜æ’­æ”¾åˆ—è¡¨åˆ°æœ¬åœ°å­˜å‚¨
            function savePlaylist() {
                localStorage.setItem('playlist', JSON.stringify(playlistSongs));
                localStorage.setItem('playlistCurrentIndex', playlistCurrentIndex);
            }
            
            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ’­æ”¾åˆ—è¡¨
            function loadPlaylist() {
                const savedPlaylist = localStorage.getItem('playlist');
                const savedIndex = localStorage.getItem('playlistCurrentIndex');
                
                if (savedPlaylist) {
                    try {
                        playlistSongs = JSON.parse(savedPlaylist);
                        playlistCurrentIndex = savedIndex ? parseInt(savedIndex) : -1;
                        updatePlaylistDisplay();
                    } catch (e) {
                        console.error('åŠ è½½æ’­æ”¾åˆ—è¡¨å¤±è´¥:', e);
                    }
                }
            }
            
            // æ˜¾ç¤ºé€šçŸ¥
            function showNotification(message) {
                // åˆ›å»ºé€šçŸ¥å…ƒç´ 
                const notification = document.createElement('div');
                notification.textContent = message;
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: var(--accent-color);
                    color: white;
                    padding: 10px 15px;
                    border-radius: 5px;
                    z-index: 1000;
                    box-shadow: 0 3px 10px rgba(0,0,0,0.2);
                    transition: all 0.3s ease;
                `;
                
                document.body.appendChild(notification);
                
                // 3ç§’åç§»é™¤é€šçŸ¥
                setTimeout(() => {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 3000);
            }
            
            // æ’­æ”¾æ­Œæ›²
            async function playSong(song, index, source) {
                try {
                    // é‡ç½®åŠ è½½çŠ¶æ€
                    lyricsLoaded = false;
                    musicLoaded = false;
                    playAfterLoad = false;
                    
                    // æ›´æ–°UIæ˜¾ç¤ºåŠ è½½çŠ¶æ€
                    currentTitle.textContent = song.name;
                    currentArtist.textContent = song.artists.map(artist => artist.name).join(', ');
                    albumTitle.textContent = song.album.name;
                    albumArtist.textContent = song.artists.map(artist => artist.name).join(', ');
                    
                    // ä½¿ç”¨æœç´¢APIè¿”å›çš„å›¾ç‰‡ä½œä¸ºä¸´æ—¶å°é¢
                    const tempCoverUrl = fixImageUrl(song.album.picUrl) || `https://cdn.jsdelivr.net/gh/Mingyyds1145/mingwebsong@main/icon/favicon.png`;
                    currentCover.src = tempCoverUrl;
                    albumCover.src = tempCoverUrl;
                    
                    lyricsContainer.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';
                    
                    // è·å–æ­Œæ›²è¯¦æƒ…
                    const response = await fetch(`https://api.injahow.cn/meting/?type=song&id=${song.id}`);
                    const data = await response.json();
                    
                    if (data && data.length > 0) {
                        const songData = data[0];
                        
                        // è®¾ç½®éŸ³é¢‘æº
                        audio.src = songData.url;
                        currentSong = songData;
                        
                        if (source === 'search') {
                            currentSongIndex = index;
                        } else if (source === 'playlist') {
                            playlistCurrentIndex = index;
                        }
                        
                        // æ›´æ–°å›¾ç‰‡ä¸ºè¯¦ç»†ä¿¡æ¯APIè¿”å›çš„å›¾ç‰‡
                        if (songData.pic) {
                            const fixedPicUrl = fixImageUrl(songData.pic);
                            if (fixedPicUrl) {
                                currentCover.src = fixedPicUrl;
                                albumCover.src = fixedPicUrl;
                            }
                        }
                        
                        // è·å–æ­Œè¯
                        if (songData.lrc) {
                            fetch(songData.lrc)
                                .then(response => response.text())
                                .then(parseLyrics)
                                .then(() => {
                                    lyricsLoaded = true;
                                    if (musicLoaded && playAfterLoad) {
                                        audio.play();
                                        player.classList.add('playing');
                                        playIcon.className = 'control-icon pause-icon';
                                        // å¦‚æœå¯ç”¨äº†æ—‹è½¬ï¼Œç¡®ä¿æ—‹è½¬åŠ¨ç”»ç»§ç»­
                                        if (isRotating) {
                                            albumCover.classList.remove('paused');
                                        }
                                    }
                                })
                                .catch(() => {
                                    lyricsContainer.innerHTML = '<div class="loading">æ­Œè¯åŠ è½½å¤±è´¥</div>';
                                    lyricsData = [];
                                    lyricsLoaded = true;
                                    if (musicLoaded && playAfterLoad) {
                                        audio.play();
                                        player.classList.add('playing');
                                        playIcon.className = 'control-icon pause-icon';
                                        // å¦‚æœå¯ç”¨äº†æ—‹è½¬ï¼Œç¡®ä¿æ—‹è½¬åŠ¨ç”»ç»§ç»­
                                        if (isRotating) {
                                            albumCover.classList.remove('paused');
                                        }
                                    }
                                });
                        } else {
                            lyricsContainer.innerHTML = '<div class="loading">æš‚æ— æ­Œè¯</div>';
                            lyricsData = [];
                            lyricsLoaded = true;
                            if (musicLoaded && playAfterLoad) {
                                audio.play();
                                player.classList.add('playing');
                                playIcon.className = 'control-icon pause-icon';
                                // å¦‚æœå¯ç”¨äº†æ—‹è½¬ï¼Œç¡®ä¿æ—‹è½¬åŠ¨ç”»ç»§ç»­
                                if (isRotating) {
                                    albumCover.classList.remove('paused');
                                }
                            }
                        }
                        
                        // ç­‰å¾…éŸ³ä¹åŠ è½½å®Œæˆ
                        audio.addEventListener('canplaythrough', function onCanPlay() {
                            musicLoaded = true;
                            audio.removeEventListener('canplaythrough', onCanPlay);
                            
                            if (lyricsLoaded && playAfterLoad) {
                                audio.play();
                                player.classList.add('playing');
                                playIcon.className = 'control-icon pause-icon';
                                // å¦‚æœå¯ç”¨äº†æ—‹è½¬ï¼Œç¡®ä¿æ—‹è½¬åŠ¨ç”»ç»§ç»­
                                if (isRotating) {
                                    albumCover.classList.remove('paused');
                                }
                            }
                        }, { once: true });
                        
                        // è®¾ç½®æ’­æ”¾çŠ¶æ€
                        playAfterLoad = true;
                        
                        // æ›´æ–°æœç´¢ç»“æœä¸­çš„æ´»åŠ¨é¡¹
                        document.querySelectorAll('.playlist-item').forEach(item => {
                            item.classList.remove('active');
                        });
                        
                        if (source === 'search') {
                            document.querySelector(`.playlist-item[data-index="${index}"]`).classList.add('active');
                        } else if (source === 'playlist') {
                            updatePlaylistDisplay();
                        }
                    }
                } catch (error) {
                    console.error('æ’­æ”¾å¤±è´¥:', error);
                    lyricsContainer.innerHTML = '<div class="loading">æ’­æ”¾å¤±è´¥ï¼Œè¯·é‡è¯•</div>';
                }
            }
            
            // è§£ææ­Œè¯
            function parseLyrics(lrcText) {
                lyricsData = [];
                const lines = lrcText.split('\n');
                
                lines.forEach(line => {
                    const timeMatch = line.match(/\[(\d+):(\d+\.\d+)\]/);
                    if (timeMatch) {
                        const minutes = parseInt(timeMatch[1]);
                        const seconds = parseFloat(timeMatch[2]);
                        const time = minutes * 60 + seconds;
                        const text = line.replace(/\[(\d+):(\d+\.\d+)\]/, '').trim();
                        
                        if (text) {
                            // åˆ†ç¦»ä¸­æ–‡å’Œå¤–æ–‡æ­Œè¯
                            const { chinese, foreign } = separateLyrics(text);
                            lyricsData.push({ time, text, chinese, foreign });
                        }
                    }
                });
                
                // æŒ‰æ—¶é—´æ’åºæ­Œè¯
                lyricsData.sort((a, b) => a.time - b.time);
                
                displayLyrics();
            }
            
            // åˆ†ç¦»ä¸­æ–‡å’Œå¤–æ–‡æ­Œè¯
            function separateLyrics(text) {
                // æ£€æŸ¥æ˜¯å¦æœ‰æ‹¬å·æ ¼å¼çš„æ­Œè¯
                const bracketMatch = text.match(/(.*)\((.*)\)/);
                
                if (bracketMatch) {
                    // å¦‚æœæœ‰æ‹¬å·ï¼Œå°è¯•åˆ†ç¦»ä¸­æ–‡å’Œå¤–æ–‡
                    const part1 = bracketMatch[1].trim();
                    const part2 = bracketMatch[2].trim();
                    
                    // ç®€å•åˆ¤æ–­ï¼šä¸­æ–‡é€šå¸¸åŒ…å«ä¸­æ–‡å­—ç¬¦ï¼Œå¤–æ–‡é€šå¸¸ä¸åŒ…å«
                    const hasChinese1 = /[\u4e00-\u9fff]/.test(part1);
                    const hasChinese2 = /[\u4e00-\u9fff]/.test(part2);
                    
                    if (hasChinese1 && !hasChinese2) {
                        // part1æ˜¯ä¸­æ–‡ï¼Œpart2æ˜¯å¤–æ–‡
                        return { chinese: part1, foreign: part2 };
                    } else if (!hasChinese1 && hasChinese2) {
                        // part1æ˜¯å¤–æ–‡ï¼Œpart2æ˜¯ä¸­æ–‡
                        return { chinese: part2, foreign: part1 };
                    } else {
                        // æ— æ³•ç¡®å®šï¼Œé»˜è®¤ç¬¬ä¸€ä¸ªæ˜¯ä¸­æ–‡ï¼Œç¬¬äºŒä¸ªæ˜¯å¤–æ–‡
                        return { chinese: part1, foreign: part2 };
                    }
                } else {
                    // æ²¡æœ‰æ‹¬å·ï¼Œæ£€æŸ¥æ˜¯å¦åŒ…å«ä¸­æ–‡å­—ç¬¦
                    const hasChinese = /[\u4e00-\u9fff]/.test(text);
                    
                    if (hasChinese) {
                        // åŒ…å«ä¸­æ–‡å­—ç¬¦ï¼Œè®¤ä¸ºæ˜¯ä¸­æ–‡æ­Œè¯
                        return { chinese: text, foreign: '' };
                    } else {
                        // ä¸åŒ…å«ä¸­æ–‡å­—ç¬¦ï¼Œè®¤ä¸ºæ˜¯å¤–æ–‡æ­Œè¯
                        return { chinese: '', foreign: text };
                    }
                }
            }
            
            // æ˜¾ç¤ºæ­Œè¯
            function displayLyrics() {
                lyricsContainer.innerHTML = '';
                
                if (lyricsData.length === 0) {
                    lyricsContainer.innerHTML = '<div class="loading">æš‚æ— æ­Œè¯</div>';
                    return;
                }
                
                lyricsData.forEach(lyric => {
                    const lyricElement = document.createElement('div');
                    lyricElement.className = 'lyric';
                    lyricElement.dataset.time = lyric.time;
                    
                    let lyricHTML = '';
                    
                    if (lyric.chinese && lyric.foreign) {
                        // åŒæ—¶æœ‰ä¸­æ–‡å’Œå¤–æ–‡æ­Œè¯
                        lyricHTML = `
                            <div class="lyric-line lyric-chinese">${lyric.chinese}</div>
                            <div class="lyric-line lyric-foreign">${lyric.foreign}</div>
                        `;
                    } else if (lyric.chinese) {
                        // åªæœ‰ä¸­æ–‡æ­Œè¯
                        lyricHTML = `<div class="lyric-line lyric-chinese">${lyric.chinese}</div>`;
                    } else if (lyric.foreign) {
                        // åªæœ‰å¤–æ–‡æ­Œè¯
                        lyricHTML = `<div class="lyric-line lyric-foreign">${lyric.foreign}</div>`;
                    } else {
                        // æ²¡æœ‰æ­Œè¯
                        lyricHTML = `<div class="lyric-line lyric-chinese">${lyric.text}</div>`;
                    }
                    
                    lyricElement.innerHTML = lyricHTML;
                    lyricsContainer.appendChild(lyricElement);
                });
            }
            
            // é«˜äº®å½“å‰æ­Œè¯
            function highlightCurrentLyric(currentTime) {
                const lyricElements = document.querySelectorAll('.lyric');
                let currentLyricIndex = -1;
                
                // æ‰¾åˆ°å½“å‰æ—¶é—´å¯¹åº”çš„æ­Œè¯
                for (let i = lyricsData.length - 1; i >= 0; i--) {
                    if (currentTime >= lyricsData[i].time) {
                        currentLyricIndex = i;
                        break;
                    }
                }
                
                // ç§»é™¤æ‰€æœ‰é«˜äº®
                lyricElements.forEach(el => el.classList.remove('active'));
                
                // é«˜äº®å½“å‰æ­Œè¯
                if (currentLyricIndex >= 0 && lyricElements[currentLyricIndex]) {
                    lyricElements[currentLyricIndex].classList.add('active');
                    
                    // å¦‚æœå¼€å¯äº†éšè—æ’­æ”¾è¿‡çš„æ­Œè¯ï¼Œåˆ™éšè—å½“å‰æ­Œè¯ä¹‹å‰çš„æ‰€æœ‰æ­Œè¯
                    if (hidePlayedLyrics) {
                        lyricElements.forEach((el, index) => {
                            if (index < currentLyricIndex) {
                                el.classList.add('played');
                            } else {
                                el.classList.remove('played');
                            }
                        });
                    }
                    
                    // æ»šåŠ¨åˆ°å½“å‰æ­Œè¯ä½ç½®
                    lyricsContainer.scrollTo({
                        top: lyricElements[currentLyricIndex].offsetTop - lyricsContainer.offsetHeight / 2 + lyricElements[currentLyricIndex].offsetHeight / 2,
                        behavior: 'smooth'
                    });
                }
            }
            
            // æ›´æ–°è¿›åº¦æ¡
            function updateProgress() {
                if (audio.duration && !isDraggingProgress) {
                    const percent = (audio.currentTime / audio.duration) * 100;
                    progress.style.width = `${percent}%`;
                    
                    // æ›´æ–°æ—¶é—´æ˜¾ç¤º
                    currentTimeEl.textContent = formatTime(audio.currentTime);
                    totalTimeEl.textContent = formatTime(audio.duration);
                    
                    // é«˜äº®å½“å‰æ­Œè¯
                    highlightCurrentLyric(audio.currentTime);
                }
            }
            
            // æ ¼å¼åŒ–æ—¶é—´
            function formatTime(seconds) {
                const min = Math.floor(seconds / 60);
                const sec = Math.floor(seconds % 60);
                return `${min}:${sec < 10 ? '0' : ''}${sec}`;
            }
            
            // ä¸‹è½½å½“å‰æ­Œæ›²
            function downloadCurrentSong() {
                if (currentSong && currentSong.url) {
                    // åˆ›å»ºä¸‹è½½é“¾æ¥
                    const a = document.createElement('a');
                    a.href = currentSong.url;
                    a.download = `${currentTitle.textContent} - ${currentArtist.textContent}.mp3`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                } else {
                    alert('æ²¡æœ‰å¯ä¸‹è½½çš„æ­Œæ›²');
                }
            }
            
            // æ›´æ–°éŸ³é‡æ˜¾ç¤º
            function updateVolumeDisplay() {
                volumeLevel.style.width = `${audio.volume * 100}%`;
                
                // æ›´æ–°éŸ³é‡å›¾æ ‡
                if (audio.volume === 0) {
                    volumeIcon.textContent = 'ğŸ”‡';
                } else if (audio.volume < 0.5) {
                    volumeIcon.textContent = 'ğŸ”ˆ';
                } else {
                    volumeIcon.textContent = 'ğŸ”Š';
                }
            }
            
            // äº‹ä»¶ç›‘å¬
            searchBtn.addEventListener('click', () => {
                searchSongs(searchInput.value);
            });
            
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    searchSongs(searchInput.value);
                }
            });
            
            clearResultsBtn.addEventListener('click', () => {
                searchResults.innerHTML = '<div class="loading">æœç´¢æ­Œæ›²ä»¥æ˜¾ç¤ºç»“æœ</div>';
                searchResultSongs = [];
            });
            
            clearPlaylistBtn.addEventListener('click', () => {
                if (confirm('ç¡®å®šè¦æ¸…ç©ºæ’­æ”¾åˆ—è¡¨å—ï¼Ÿ')) {
                    playlistSongs = [];
                    playlistCurrentIndex = -1;
                    updatePlaylistDisplay();
                    savePlaylist();
                    
                    // å¦‚æœæ­£åœ¨æ’­æ”¾ï¼Œåœæ­¢æ’­æ”¾
                    if (!audio.paused) {
                        audio.pause();
                        player.classList.remove('playing');
                        playIcon.className = 'control-icon play-icon';
                    }
                }
            });
            
            playPauseBtn.addEventListener('click', () => {
                if (audio.paused) {
                    if (currentSong) {
                        // å¦‚æœéŸ³ä¹å’Œæ­Œè¯éƒ½å·²åŠ è½½ï¼Œç›´æ¥æ’­æ”¾
                        if (musicLoaded && lyricsLoaded) {
                            audio.play();
                            player.classList.add('playing');
                            playIcon.className = 'control-icon pause-icon';
                            // å¦‚æœå¯ç”¨äº†æ—‹è½¬ï¼Œç¡®ä¿æ—‹è½¬åŠ¨ç”»ç»§ç»­
                            if (isRotating) {
                                albumCover.classList.remove('paused');
                            }
                        } else {
                            // å¦åˆ™è®¾ç½®æ’­æ”¾æ ‡å¿—ï¼Œç­‰å¾…åŠ è½½å®Œæˆåæ’­æ”¾
                            playAfterLoad = true;
                            player.classList.add('playing');
                            playIcon.className = 'control-icon pause-icon';
                        }
                    } else if (playlistSongs.length > 0) {
                        // ä¼˜å…ˆä»æ’­æ”¾åˆ—è¡¨æ’­æ”¾
                        playFromPlaylist(0);
                    } else if (searchResultSongs.length > 0) {
                        // å¦‚æœæ²¡æœ‰å½“å‰æ­Œæ›²ä½†æœ‰æœç´¢ç»“æœï¼Œæ’­æ”¾ç¬¬ä¸€é¦–
                        playSong(searchResultSongs[0], 0, 'search');
                    } else {
                        alert('è¯·å…ˆæœç´¢å¹¶é€‰æ‹©ä¸€é¦–æ­Œæ›²');
                    }
                } else {
                    audio.pause();
                    player.classList.remove('playing');
                    playIcon.className = 'control-icon play-icon';
                    // æš‚åœæ—‹è½¬åŠ¨ç”»
                    if (isRotating) {
                        albumCover.classList.add('paused');
                    }
                }
            });
            
            prevBtn.addEventListener('click', () => {
                if (playlistSongs.length > 0 && playlistCurrentIndex > 0) {
                    playFromPlaylist(playlistCurrentIndex - 1);
                } else if (searchResultSongs.length > 0 && currentSongIndex > 0) {
                    playSong(searchResultSongs[currentSongIndex - 1], currentSongIndex - 1, 'search');
                }
            });
            
            nextBtn.addEventListener('click', () => {
                if (playlistSongs.length > 0 && playlistCurrentIndex < playlistSongs.length - 1) {
                    playFromPlaylist(playlistCurrentIndex + 1);
                } else if (searchResultSongs.length > 0 && currentSongIndex < searchResultSongs.length - 1) {
                    playSong(searchResultSongs[currentSongIndex + 1], currentSongIndex + 1, 'search');
                }
            });
            
            downloadBtn.addEventListener('click', downloadCurrentSong);
            
            // ä¸»é¢˜åˆ‡æ¢
            themeToggle.addEventListener('click', toggleTheme);
            
            // è®¾ç½®æŒ‰é’®
            settingsBtn.addEventListener('click', toggleSettingsMenu);
            
            // ä¸“è¾‘å°é¢æ§åˆ¶
            circularToggle.addEventListener('click', toggleCircular);
            rotateToggle.addEventListener('click', toggleRotate);
            
            // éšè—æ­Œè¯æ§åˆ¶
            hideLyricsToggle.addEventListener('click', toggleHideLyrics);
            
            // é¢œè‰²è®¾ç½®æ§åˆ¶
            colorSettingsToggle.addEventListener('click', toggleColorSettingsPanel);
            colorSettingsClose.addEventListener('click', () => {
                colorSettingsPanel.classList.remove('show');
            });
            
            // é¢œè‰²é€‰æ‹©å™¨äº‹ä»¶
            bgPrimaryColor.addEventListener('input', (e) => {
                updateColor('--bg-primary', e.target.value);
            });
            
            bgSecondaryColor.addEventListener('input', (e) => {
                updateColor('--bg-secondary', e.target.value);
            });
            
            textPrimaryColor.addEventListener('input', (e) => {
                updateColor('--text-primary', e.target.value);
            });
            
            textSecondaryColor.addEventListener('input', (e) => {
                updateColor('--text-secondary', e.target.value);
            });
            
            accentColor.addEventListener('input', (e) => {
                updateColor('--accent-color', e.target.value);
            });
            
            borderColor.addEventListener('input', (e) => {
                updateColor('--border-color', e.target.value);
            });
            
            // é‡ç½®é¢œè‰²æŒ‰é’®
            colorResetBtn.addEventListener('click', resetColors);
            
            // ä¾§è¾¹æ æ§åˆ¶
            toggleSidebarBtn.addEventListener('click', toggleSidebar);
            
            // ä¾§è¾¹æ æ ‡ç­¾åˆ‡æ¢
            sidebarTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    switchTab(tab.dataset.tab);
                });
            });
            
            // è¿›åº¦æ¡æ‹–åŠ¨åŠŸèƒ½
            progressBar.addEventListener('mousedown', (e) => {
                isDraggingProgress = true;
                progressBar.classList.add('dragging');
                updateProgressPosition(e);
            });
            
            document.addEventListener('mousemove', (e) => {
                if (isDraggingProgress) {
                    updateProgressPosition(e);
                }
            });
            
            document.addEventListener('mouseup', () => {
                if (isDraggingProgress) {
                    isDraggingProgress = false;
                    progressBar.classList.remove('dragging');
                }
            });
            
            function updateProgressPosition(e) {
                if (!audio.duration) return;
                
                const rect = progressBar.getBoundingClientRect();
                const percent = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
                progress.style.width = `${percent * 100}%`;
                audio.currentTime = percent * audio.duration;
                currentTimeEl.textContent = formatTime(audio.currentTime);
                
                // æ›´æ–°æ­Œè¯é«˜äº®
                highlightCurrentLyric(audio.currentTime);
            }
            
            // éŸ³é‡æ¡æ‹–åŠ¨åŠŸèƒ½
            volumeBarContainer.addEventListener('mousedown', (e) => {
                isDraggingVolume = true;
                volumeBarContainer.classList.add('dragging');
                updateVolumePosition(e);
            });
            
            document.addEventListener('mousemove', (e) => {
                if (isDraggingVolume) {
                    updateVolumePosition(e);
                }
            });
            
            document.addEventListener('mouseup', () => {
                if (isDraggingVolume) {
                    isDraggingVolume = false;
                    volumeBarContainer.classList.remove('dragging');
                }
            });
            
            function updateVolumePosition(e) {
                const rect = volumeBarContainer.getBoundingClientRect();
                const percent = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
                audio.volume = percent;
                updateVolumeDisplay();
            }
            
            // ç‚¹å‡»éŸ³é‡å›¾æ ‡åˆ‡æ¢é™éŸ³
            volumeIcon.addEventListener('click', () => {
                if (audio.volume > 0) {
                    audio.volume = 0;
                } else {
                    audio.volume = 0.7;
                }
                updateVolumeDisplay();
            });
            
            // éŸ³é¢‘äº‹ä»¶
            audio.addEventListener('timeupdate', updateProgress);
            
            audio.addEventListener('ended', () => {
                player.classList.remove('playing');
                playIcon.className = 'control-icon play-icon';
                // æš‚åœæ—‹è½¬åŠ¨ç”»
                if (isRotating) {
                    albumCover.classList.add('paused');
                }
                
                // ä¼˜å…ˆä»æ’­æ”¾åˆ—è¡¨æ’­æ”¾ä¸‹ä¸€é¦–
                if (playlistSongs.length > 0 && playlistCurrentIndex < playlistSongs.length - 1) {
                    playFromPlaylist(playlistCurrentIndex + 1);
                } else if (searchResultSongs.length > 0 && currentSongIndex < searchResultSongs.length - 1) {
                    // å¦‚æœæ²¡æœ‰æ’­æ”¾åˆ—è¡¨ï¼Œä»æœç´¢ç»“æœæ’­æ”¾ä¸‹ä¸€é¦–
                    playSong(searchResultSongs[currentSongIndex + 1], currentSongIndex + 1, 'search');
                }
            });
            
            // åˆå§‹åŒ–
            initTheme();
            initAlbumState();
            initHideLyricsState();
            loadColorSettings();
            loadPlaylist();
            updateProgress();
            updateVolumeDisplay();
        });
    </script>
</body>
</html>
